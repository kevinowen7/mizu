<!doctype html>
<html lang="en">

<head>
    <%- include('../partials-admin/head.ejs') %>
    <title>History - Mizu</title>
</head>
<body>
    <div class="app-container app-theme-white body-tabs-shadow fixed-sidebar fixed-header">
        <%- include('../partials-admin/menu.ejs') %>
            <div class="app-main">
                <div class="app-sidebar sidebar-shadow">
                    <div class="app-header__logo">
                        <div class="logo-src"></div>
                        <div class="header__pane ml-auto">
                            <div>
                                <button type="button" class="hamburger close-sidebar-btn hamburger--elastic" data-class="closed-sidebar">
                                    <span class="hamburger-box">
                                        <span class="hamburger-inner"></span>
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="app-header__mobile-menu">
                        <div>
                            <button type="button" class="hamburger hamburger--elastic mobile-toggle-nav">
                                <span class="hamburger-box">
                                    <span class="hamburger-inner"></span>
                                </span>
                            </button>
                        </div>
                    </div>
                    <div class="app-header__menu">
                        <span>
                            <button type="button" class="btn-icon btn-icon-only btn btn-primary btn-sm mobile-toggle-header-nav">
                                <span class="btn-icon-wrapper">
                                    <i class="fa fa-ellipsis-v fa-w-6"></i>
                                </span>
                            </button>
                        </span>
                    </div>    <div class="scrollbar-sidebar">
                        <div class="app-sidebar__inner">
                            <ul class="vertical-nav-menu">
                                <li class="app-sidebar__heading">Dashboard</li>
                                <li>
                                    <a href="./dashboard">
                                        <i class="metismenu-icon pe-7s-rocket"></i>
                                        Dashboard
                                    </a>
                                </li>
                            </ul>
                            <ul class="vertical-nav-menu">
                                <li class="app-sidebar__heading">Stock</li>
                                <li>
                                    <a href="./stock">
                                        <i class="metismenu-icon pe-7s-box2"></i>
                                        Stock
                                    </a>
                                </li>
                            </ul>
                            <ul class="vertical-nav-menu">
                                <li class="app-sidebar__heading">History</li>
                                <li>
                                    <a href="./history" class="mm-active">
                                        <i class="metismenu-icon pe-7s-timer"></i>
                                        History
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>    
                <div class="app-main__outer">    
                    <div class="app-main__inner">
                        <div class="row">
                            <div class="col-md-6 col-xl-6">
                                <div class="card mb-3 widget-content bg-grow-early">
                                    <div class="widget-content-wrapper text-white">
                                        <div class="widget-content-left">
                                            <div class="widget-heading">Total Completed</div>
                                            <div class="widget-subheading">All Data</div>
                                        </div>
                                        <div class="widget-content-right">
                                            <% var total = 0 ;for(var i = 0; i < results.length; i++) { %>
                                                <% if(results[i].status==1) { %>
                                                    <% total = total+1 %>
                                                <% } %>
                                           <% } %>
                                            <div class="widget-numbers text-white"><span><%= total %></span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-6">
                                <div class="card mb-3 widget-content bg-danger">
                                    <div class="widget-content-wrapper text-white">
                                        <div class="widget-content-left">
                                            <div class="widget-heading">Total Failed</div>
                                            <div class="widget-subheading">All Data</div>
                                        </div>
                                        <div class="widget-content-right">
                                            <% var total = 0 ;for(var i = 0; i < results.length; i++) { %>
                                                <% if(results[i].status==-1) { %>
                                                    <% total = total+1 %>
                                                <% } %>
                                           <% } %>
                                            <div class="widget-numbers text-white"><span><%= total %></span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 col-lg-12">
                                <div class="mb-3 card">
                                    <div class="card-body">
                                        <div class="row" style="margin-bottom: 20px;padding-left: 15px;padding-right: 15px;">
                                            <h5 class="card-title prim text-success">Completed Order</h5>
                                        </div>
                                        <table id="completed_table" class="mb-0 table table-success" style="text-align: center;">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Customer</th>
                                                    <th>Address</th>
                                                    <th>Phone Number</th>
                                                    <th>Brand</th>
                                                    <th>Quantity</th>
                                                    <th>Price</th>
                                                    <th>Date</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% var x = 0; for(var i = 0; i < results.length; i++) { %>
                                                    <% if(results[i].status==1) { %>
                                                    <tr>
                                                        <th scope="row"><%= x+1 %></th>
                                                        <td><%= results[i].nama %></td>
                                                        <td><%= results[i].alamat %></td>
                                                        <td><%= results[i].no_hp %></td>
                                                        <td><%= results[i].brand %></td>
                                                        <td><%= results[i].jmlh_galon %></td>
                                                        <td class="convertMoney"><%= results[i].harga_total %></td>
                                                        <td class="convertDate"><%= results[i].date %></td>
                                                    </tr>
                                                    <% x=x+1 } %>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 col-lg-12">
                                <div class="mb-3 card">
                                    <div class="card-body">
                                        <div class="row" style="margin-bottom: 20px;padding-left: 15px;padding-right: 15px;">
                                            <h5 class="card-title prim text-danger">Failed Order</h5>
                                        </div>
                                        <table id="failed_table" class="mb-0 table table-danger" style="text-align: center;">
                                            <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Customer</th>
                                                <th>Address</th>
                                                <th>Phone Number</th>
                                                <th>Brand</th>
                                                <th>Quantity</th>
                                                <th>Price</th>
                                                <th>Date</th>
                                                <th>Action</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                                <% var x = 0; for(var i = 0; i < results.length; i++) { %>
                                                    <% if(results[i].status==-1) { %>
                                                    <tr>
                                                        <th scope="row"><%= x+1 %></th>
                                                        <td><%= results[i].nama %></td>
                                                        <td><%= results[i].alamat %></td>
                                                        <td><%= results[i].no_hp %></td>
                                                        <td><%= results[i].brand %></td>
                                                        <td><%= results[i].jmlh_galon %></td>
                                                        <td class="convertMoney"><%= results[i].harga_total %></td>
                                                        <td class="convertDate"><%= results[i].date %></td>
                                                        <td>
                                                            <button class="mr-2 btn-icon btn-icon-only btn btn-outline-danger" onClick="showMessage('<%= results[i].failed_msg %>')"><i class="pe-7s-mail btn-icon-wrapper"> </i></button>
                                                        </td>
                                                    </tr>
                                                    <% x=x+1 } %>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            
        </div>
    </div>
    <button id="cancel" data-toggle="modal" data-target="#show_cancel" style="display:none">Click</button>
    <div class="modal fade" id="show_cancel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Cancellation Message</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
            <p><b>Message : </b></p>
            <span id="msg_val"></span>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
    </div>
    <%- include('../partials-admin/footer.ejs') %>
    <script>
        $('#failed_table').DataTable({
            "responsive": true,
            "columnDefs": [
                { "width": "5%", "targets": 0 },
                { "width": "15%", "targets": -2 },
                { "width": "5%", "targets": -1 },
                { "width": "25%", "targets": 2 },
                { 
                    "orderable": false, 
                    "targets": [1,2,3,-1] 
                }
            ]
        });

        $('#completed_table').DataTable({
            "responsive": true,
            "columnDefs": [
                { "width": "5%", "targets": 0 },
                { "width": "15%", "targets": 1 },
                { "width": "10%", "targets": -1 },
                { "width": "25%", "targets": 2 },
                { 
                    "orderable": false, 
                    "targets": [1,2,3,-1] 
                }
            ]
        });
        function showMessage(data){
            $("#msg_val").html(data)
            $("#cancel").click()
        }
        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2) 
                month = '0' + month;
            if (day.length < 2) 
                day = '0' + day;

            return [year, month, day].join('-');
        }
        $(".convertDate").each(function() {
            $(this).html(formatDate($(this).html()))
        });

        function rem_moneydot(money) {
	
            return parseInt(money.split(".").join(""));
            
        }

        function get_moneydot(money) {
            
            if (isNaN(parseInt(money))) {
                var convertmoney = "";
            } else {
                money = rem_moneydot(money);
                var convertmoney = money.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1.");
            }
            return convertmoney;
            
        }

        $(".convertMoney").each(function() {
            $(this).html(get_moneydot($(this).html()))
        });
    </script>
</body>
</html>
